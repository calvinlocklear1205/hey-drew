# HeyDrew — Data Model

This document defines the core data entities, their relationships, and key attributes. Derived from the prototype's simulated data and UI requirements.

> **Note:** No database exists yet. This model is inferred from what the prototype displays, stores in-memory, and what the UI needs to function.

---

## Entity Relationship Diagram

```
┌──────────────┐       ┌──────────────┐       ┌──────────────┐
│  TaxPro      │       │ AccessToken  │       │  Client      │
│ (CPA/Admin)  │──1:N──│              │──1:1──│ (Business    │
│              │       │              │       │  Owner)      │
└──────┬───────┘       └──────────────┘       └──────┬───────┘
       │                                             │
       │                                             │
       │              ┌──────────────┐               │
       └──────N:1─────│    Case      │─────1:1───────┘
                      │              │
                      └──┬───┬───┬───┘
                         │   │   │
              ┌──────────┘   │   └──────────┐
              ▼              ▼              ▼
       ┌──────────┐  ┌──────────────┐ ┌──────────┐
       │ Document │  │  Strategy    │ │ Message  │
       │          │  │ Recommendation│ │ Thread   │
       └──────────┘  └──────┬───────┘ └──────────┘
                            │
                     ┌──────▼───────┐
                     │    Task      │
                     │ (impl. step) │
                     └──────────────┘
```

---

## Entity Definitions

### Client (Business Owner)

The person using the client app. Created during onboarding.

| Field | Type | Notes |
|---|---|---|
| `id` | UUID | Primary key |
| `email` | string | Entered at token redemption, confirmed at profile |
| `password_hash` | string | Created during signup |
| `contact_name` | string | Full name |
| `phone` | string | Format: `(XXX) XXX-XXXX` |
| `business_name` | string | e.g., "Smith Consulting LLC" |
| `business_type` | enum | `retail_ecommerce`, `service`, `consulting` |
| `tax_year` | integer | The year being optimized (e.g., 2024) |
| `created_at` | timestamp | |
| `token_id` | FK → AccessToken | The token used to create the account |

---

### TaxPro (Admin User)

The CPA or tax professional who reviews cases.

| Field | Type | Notes |
|---|---|---|
| `id` | UUID | Primary key |
| `name` | string | Display name |
| `email` | string | Login email |
| `role` | enum | `admin`, `reviewer` (future) |
| `avatar_url` | string | Profile image |

---

### AccessToken

Invite codes generated by tax professionals to onboard clients.

| Field | Type | Notes |
|---|---|---|
| `id` | UUID | Primary key |
| `code` | string | Format: `DREW-XXXX-XXXX` |
| `status` | enum | `active`, `used`, `expired` |
| `generated_by` | FK → TaxPro | Who created it |
| `redeemed_by` | FK → Client | Null until used |
| `created_at` | timestamp | |
| `redeemed_at` | timestamp | Null until used |

---

### Case

The central entity tying everything together. One case per client per tax year.

| Field | Type | Notes |
|---|---|---|
| `id` | string | Display format: `CASE-XXXX` |
| `client_id` | FK → Client | |
| `taxpro_id` | FK → TaxPro | Assigned reviewer |
| `status` | enum | `new`, `in_review`, `needs_attention`, `pending_client`, `approved` |
| `tax_year` | integer | |
| `created_at` | timestamp | |
| `updated_at` | timestamp | |

---

### Document

Files uploaded by the client for analysis.

| Field | Type | Notes |
|---|---|---|
| `id` | UUID | Primary key |
| `case_id` | FK → Case | |
| `file_name` | string | Original filename |
| `file_type` | string | MIME type |
| `file_size` | integer | Bytes |
| `doc_category` | enum | `tax_return`, `schedule_c`, `expense_record`, `1099`, `other` |
| `parse_status` | enum | `pending`, `parsed`, `incomplete`, `error` |
| `extracted_data` | JSON | Structured fields pulled from document (e.g., filing status, gross income) |
| `uploaded_at` | timestamp | |

**Extracted data example (from prototype's document viewer):**
```json
{
  "filing_status": "Single",
  "gross_income": 185000,
  "business_income": 142000,
  "total_deductions": 23500,
  "tax_owed": 41200
}
```

---

### Strategy (Library Item)

A reusable tax strategy definition. Tax professionals maintain this library.

| Field | Type | Notes |
|---|---|---|
| `id` | UUID | Primary key |
| `name` | string | e.g., "Augusta Rule" |
| `description` | text | Plain-language explanation |
| `how_it_works` | text | Step-by-step breakdown |
| `savings_range` | string | e.g., "$5,000–$24,000/year" |
| `requirements` | text[] | Eligibility criteria |
| `category` | string | e.g., "Home-based", "Retirement", "Insurance" |
| `applicable_business_types` | enum[] | Which business types this applies to |

**Known strategies from prototype:**
| Strategy | Savings Estimate | Key Requirement |
|---|---|---|
| Augusta Rule | Up to $24,000/year | Own home, host business meetings |
| SEP-IRA Contributions | Up to $66,000/year | Self-employed |
| Self-Employed Health Insurance | Varies | Self-employed, paying own premiums |
| Hire Family Members | Varies | Family members involved in business |

---

### StrategyRecommendation

A strategy applied to a specific case, with approval workflow.

| Field | Type | Notes |
|---|---|---|
| `id` | UUID | Primary key |
| `case_id` | FK → Case | |
| `strategy_id` | FK → Strategy | |
| `estimated_savings` | integer | Dollar amount for this specific client |
| `status` | enum | `recommended`, `approved`, `rejected` |
| `recommended_at` | timestamp | When AI suggested it |
| `reviewed_by` | FK → TaxPro | Who approved/rejected |
| `reviewed_at` | timestamp | |

---

### Task

Implementation steps for an approved strategy. Assigned to the client.

| Field | Type | Notes |
|---|---|---|
| `id` | integer | Sequential within a recommendation |
| `recommendation_id` | FK → StrategyRecommendation | |
| `title` | string | e.g., "Document home office space" |
| `description` | text | Detailed instructions |
| `due_date` | date | e.g., "Jan 31" |
| `completed` | boolean | Toggled by client |
| `reminder_enabled` | boolean | Client preference |
| `sort_order` | integer | Display order |

---

### MessageThread / Message

Communication between client and tax professional.

**MessageThread:**
| Field | Type | Notes |
|---|---|---|
| `id` | UUID | Primary key |
| `case_id` | FK → Case | |
| `subject` | string | Thread title |
| `last_message_at` | timestamp | For sorting |
| `unread_count` | integer | Per-user unread count |

**Message:**
| Field | Type | Notes |
|---|---|---|
| `id` | UUID | Primary key |
| `thread_id` | FK → MessageThread | |
| `sender_type` | enum | `client`, `taxpro` |
| `sender_id` | UUID | FK to Client or TaxPro |
| `body` | text | Message content |
| `sent_at` | timestamp | |
| `read` | boolean | |

---

### ActivityLog

Audit trail for admin visibility.

| Field | Type | Notes |
|---|---|---|
| `id` | UUID | Primary key |
| `case_id` | FK → Case | Nullable (some events are case-independent) |
| `actor_type` | enum | `client`, `taxpro`, `system` |
| `actor_id` | UUID | |
| `action` | string | e.g., `document_uploaded`, `strategy_approved`, `status_changed` |
| `details` | JSON | Additional context |
| `created_at` | timestamp | |

---

## Key Relationships Summary

- A **TaxPro** generates many **AccessTokens**
- A **Client** redeems one **AccessToken** to create an account
- A **Client** has one **Case** (per tax year)
- A **Case** is assigned to one **TaxPro**
- A **Case** has many **Documents**, **StrategyRecommendations**, and **MessageThreads**
- A **StrategyRecommendation** links a **Strategy** (library) to a **Case**
- A **StrategyRecommendation** has many **Tasks**
- A **MessageThread** has many **Messages**
- **ActivityLog** entries reference a **Case** and an actor
